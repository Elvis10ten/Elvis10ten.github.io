{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/2017-10-09-loading-images-from-json-response-advanced-android-glide-tips-part-2/","result":{"data":{"post":{"__typename":"MdxPost","slug":"/2017-10-09-loading-images-from-json-response-advanced-android-glide-tips-part-2/","title":"Loading Images From JSON Response — Advanced Android Glide Tips Part 2","date":"09.10.2017","tags":[{"name":"android","slug":"android"}],"description":null,"canonicalUrl":"https://elvischidera.com/2017-10-09-loading-images-from-json-response-advanced-android-glide-tips-part-2/","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Loading Images From JSON Response — Advanced Android Glide Tips Part 2\",\n  \"date\": \"2017-10-09T00:00:00.000Z\",\n  \"slug\": \"/2017-10-09-loading-images-from-json-response-advanced-android-glide-tips-part-2/\",\n  \"canonicalUrl\": \"https://elvischidera.com/2017-10-09-loading-images-from-json-response-advanced-android-glide-tips-part-2/\",\n  \"banner\": \"./assets/banner.jpeg\",\n  \"tags\": [\"android\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"You have probably been in a situation where you wanted to load some images into an ImageView but the API call to get the image returns a JSON object that contains a field specifying the actual image URL. This usually happens when you are using a third-party service and can\\u2019t modify the behavior of the API.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"900px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/da930f876ed2e06c59c9f8dfafa1b2d9/86440/banner.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"56.25%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwAE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAP/2gAMAwEAAhADEAAAARQNE6lFH//EABcQAAMBAAAAAAAAAAAAAAAAAAABAhL/2gAIAQEAAQUCKEaaVVWT/8QAFREBAQAAAAAAAAAAAAAAAAAAABL/2gAIAQMBAT8BlL//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwGq/8QAGBABAAMBAAAAAAAAAAAAAAAAAQAQIRH/2gAIAQEABj8CmtYwe1//xAAaEAEBAQEAAwAAAAAAAAAAAAABABExQYHR/9oACAEBAAE/IRPO+pKgXNlGMhrCI9fl12//2gAMAwEAAgADAAAAEIjf/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAwEBPxBXIwX/xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAECAQE/ENjpn//EABkQAQEBAQEBAAAAAAAAAAAAAAERADFBsf/aAAgBAQABPxCRQgPWMQkCB81BSy5EJCgy42Fio96yqJqtXf/Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"banner\",\n    \"title\": \"banner\",\n    \"src\": \"/static/da930f876ed2e06c59c9f8dfafa1b2d9/86440/banner.jpg\",\n    \"srcSet\": [\"/static/da930f876ed2e06c59c9f8dfafa1b2d9/46946/banner.jpg 240w\", \"/static/da930f876ed2e06c59c9f8dfafa1b2d9/55489/banner.jpg 480w\", \"/static/da930f876ed2e06c59c9f8dfafa1b2d9/86440/banner.jpg 900w\"],\n    \"sizes\": \"(max-width: 900px) 100vw, 900px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"This was a challenge I faced when I decided to use the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.last.fm/api\"\n  }), \"Last.FM API\"), \" for \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://play.google.com/store/apps/details?id=com.appcore.fxmusicplayer&hl=en\"\n  }), \"FX Music Player\"), \". One way to solve this is to create a loader or AsyncTask that makes the API call then parses the JSON response and return the image URL. But each time you want to load an image you will have to manage multiple requests yourself and this gets difficult when you have a List or RecyclerView where items get reused.\"), mdx(\"p\", null, \"I will show you a neat trick that allows you to load images from a JSON response using the Glide library. Each time you want to load an image, it will just take a single line with no additional stress.\"), mdx(\"p\", null, \"First, create a request class. This will be a regular java class with any fields/variables you want to add to it. Example:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=JsonRequest.java\"\n  }), \"public class JsonRequest {\\n    \\n    // Add any field you can use to identify the request or that will hold values you will\\n    // pass to the api endpoint. For example this can be an id, name, size or any other thing\\n}\\n\")), mdx(\"p\", null, \"Next, create a class that models the API JSON response. This is also just a regular java class and you can add any field/variable to it. You can use the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://www.jsonschema2pojo.org\"\n  }), \"JSONSchema2Pojo\"), \" tool to do the API response modeling. Example:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=JsonResponse.java\"\n  }), \"public class JsonResponse {\\n    \\n    // This class should contain fields that model the response from the api call you are making\\n    // You can use this site to create a proper model based on the response: http://www.jsonschema2pojo.org/\\n}\\n\")), mdx(\"p\", null, \"Next, we will have to create a custom Glide ModelLoader. This will be the class doing most of the work here like making the network calls and parsing the JSON response.\"), mdx(\"p\", null, \"In order to keep this post HTTP library agnostic, I didn\\u2019t include any HTTP calls in the example code below. Just follow the TODO comments in the code below and use whatever HTTP library you are already using in your project to make the HTTP requests.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=JsonModelLoader.java\"\n  }), \"import android.support.annotation.NonNull;\\nimport android.support.annotation.Nullable;\\n    \\nimport com.bumptech.glide.Priority;\\nimport com.bumptech.glide.load.data.DataFetcher;\\nimport com.bumptech.glide.load.model.stream.StreamModelLoader;\\n    \\nimport java.io.IOException;\\nimport java.io.InputStream;\\n    \\npublic class JsonModelLoader implements StreamModelLoader<JsonRequest> {\\n    \\n    public JsonModelLoader() {}\\n    \\n    @Override\\n    public DataFetcher<InputStream> getResourceFetcher(final JsonRequest model, int width, int height) {\\n        // Return a custom ImageLoader that will handle a JSON response\\n        return new JsonImageLoader(model);\\n    }\\n    \\n    private static class JsonImageLoader implements DataFetcher<InputStream> {\\n    \\n        private final JsonRequest model;\\n    \\n        JsonImageLoader(@NonNull JsonRequest model) {\\n            this.model = model;\\n        }\\n    \\n        @Override\\n        public InputStream loadData(Priority priority) throws IOException {\\n            JsonResponse jsonResponse = makeApiCallToGetData(model);\\n    \\n            if (jsonResponse != null) {\\n                return getInputStreamFromApiResponse(jsonResponse);\\n            }\\n    \\n            return null;\\n        }\\n    \\n        private @Nullable JsonResponse makeApiCallToGetData(@NonNull JsonRequest model) {\\n            // TODO: Make the call to the API to fetch data for the given model.\\n            // You can use any field you added to the model class here like ids, name, and more\\n            // Feel free to use any networking library here like OkHttp, Ion or any other.\\n            return null;\\n        }\\n    \\n        private @Nullable InputStream getInputStreamFromApiResponse(@NonNull JsonResponse response) {\\n            // TODO: Make the actual call to fetch the image data from the url specified in the Json Response\\n            // Use your favorite Http client (OkHTTP, Ion and more) and just return the input stream\\n            return null;\\n        }\\n    \\n        @Override\\n        public String getId() {\\n            // TODO: Do not return null, rather return a value that uniquely identifies the request else caching won't work\\n            // This can be any unique field in the model class\\n            return null;\\n        }\\n    \\n        @Override\\n        public void cancel() {\\n            // You can ignore for now\\n        }\\n    \\n        @Override\\n        public void cleanup() {\\n            // Do any necessary cleanup\\n        }\\n            \\n    }\\n    \\n}\\n\")), mdx(\"p\", null, \"You will have to create a custom ModelLoaderFactory that returns your newly created ModelLoader. Its pretty straightforward, this class just returns a new instance of the JsonModelLoader. Use the code below:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=JsonModelLoaderFactory.java\"\n  }), \"import android.content.Context;\\n    \\nimport com.bumptech.glide.load.model.GenericLoaderFactory;\\nimport com.bumptech.glide.load.model.ModelLoader;\\nimport com.bumptech.glide.load.model.ModelLoaderFactory;\\n    \\nimport java.io.InputStream;\\n    \\nclass JsonModelLoaderFactory implements ModelLoaderFactory<JsonRequest, InputStream> {\\n    \\n    @Override\\n    public ModelLoader<JsonRequest, InputStream> build(Context context, GenericLoaderFactory factories) {\\n        return new JsonModelLoader();\\n    }\\n    \\n    @Override\\n    public void teardown() {}    \\n}\\n\")), mdx(\"p\", null, \"Then create a GlideModule that will allow us to use the JsonRequest class we created above to make requests with Glide. All we will be doing in this class is just to register our custom component (You can have several components, all you have to do is register them here so they will work). Use the code below to register the JsonModelLoader:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=MyGlideModule.java\"\n  }), \"import android.content.Context;\\n    \\nimport com.bumptech.glide.Glide;\\nimport com.bumptech.glide.GlideBuilder;\\nimport com.bumptech.glide.load.DecodeFormat;\\nimport com.bumptech.glide.module.GlideModule;\\n    \\nimport java.io.InputStream;\\n    \\npublic class MyGlideModule implements GlideModule {\\n    \\n    @Override\\n    public void applyOptions(Context context, GlideBuilder builder) {}\\n    \\n    @Override\\n    public void registerComponents(Context context, Glide glide) {\\n        // register ModelLoaders here.\\n        glide.register(JsonRequest.class, InputStream.class, new JsonModelLoaderFactory());\\n    }\\n}\\n\")), mdx(\"p\", null, \"Finally, add the GlideModule in your AndroidManifest.xml file. This is pretty easy, just use the code below to do that (don\\u2019t forget to change your.company.package.name to your actual package name).\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-xml:title=AndroidManifest.xml\"\n  }), \"<manifest xmlns:android=\\\"http://schemas.android.com/apk/res/android\\\">\\n\\n    <application>\\n\\n        <!-- Register Glide Module -->\\n        <meta-data\\n            android:name=\\\"**your.company.package.name.MyGlideModule**\\\"\\n            android:value=\\\"GlideModule\\\" />\\n\\n    </application>\\n\\n</manifest\\n\")), mdx(\"p\", null, \"Everything is all set now. If you want to load images, it\\u2019s really really easy. Just use do something like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=GlideUsage.java\"\n  }), \"JsonRequest jsonRequest = new JsonRequest();\\n// Set any of the request object fields you defined\\nGlide.with(this).load(jsonRequest).into(imageView);\\n\")), mdx(\"p\", null, \"Once you understand the concepts explained here, you will be able to create more custom loaders to handle different types of requests/responses.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"You have probably been in a situation where you wanted to load some images into an ImageView but the API call to get the image returns a…","timeToRead":2,"banner":{"childImageSharp":{"resize":{"src":"/static/da930f876ed2e06c59c9f8dfafa1b2d9/a6c62/banner.jpg"}}}}},"pageContext":{"slug":"/2017-10-09-loading-images-from-json-response-advanced-android-glide-tips-part-2/","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["3090400250","3090400250","318001574"]}