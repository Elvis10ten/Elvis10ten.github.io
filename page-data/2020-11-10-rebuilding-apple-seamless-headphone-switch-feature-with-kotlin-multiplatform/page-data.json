{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/2020-11-10-rebuilding-apple-seamless-headphone-switch-feature-with-kotlin-multiplatform/","result":{"data":{"post":{"__typename":"MdxPost","slug":"/2020-11-10-rebuilding-apple-seamless-headphone-switch-feature-with-kotlin-multiplatform/","title":"Rebuilding Apple Seamless Headphone Switch Feature with Kotlin MultiPlatform","date":"10.11.2020","tags":[{"name":"Bluetooth","slug":"bluetooth"},{"name":"Audio","slug":"audio"},{"name":"Kotlin Multiplatform","slug":"kotlin-multiplatform"},{"name":"Android","slug":"android"}],"description":null,"canonicalUrl":"https://elvischidera.com/2020-11-10-rebuilding-apple-seamless-headphone-switch-feature-with-kotlin-multiplatform/","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Rebuilding Apple Seamless Headphone Switch Feature with Kotlin MultiPlatform\",\n  \"date\": \"2020-11-10T00:00:00.000Z\",\n  \"slug\": \"/2020-11-10-rebuilding-apple-seamless-headphone-switch-feature-with-kotlin-multiplatform/\",\n  \"canonicalUrl\": \"https://elvischidera.com/2020-11-10-rebuilding-apple-seamless-headphone-switch-feature-with-kotlin-multiplatform/\",\n  \"banner\": \"./assets/inspiration_tweet.png\",\n  \"tags\": [\"Bluetooth\", \"Audio\", \"Kotlin Multiplatform\", \"Android\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"The inspiration for this project came from this tweet.\"), mdx(\"blockquote\", {\n    className: \"twitter-tweet\",\n    \"data-theme\": \"dark\"\n  }, mdx(\"p\", {\n    lang: \"en\",\n    dir: \"ltr\"\n  }, \"AirPods will now automatically switch between devices by recognizing if you put down your phone and pick up your iPad. Or if you\\u2019re on your iPad and you get a phone call, it\\u2019ll switch back to the phone. That\\u2019s the type of experience only a complete ecosystem can create.\"), \"\\u2014 Marques Brownlee (@MKBHD) \", mdx(\"a\", {\n    href: \"https://twitter.com/MKBHD/status/1275122690618261511?ref_src=twsrc%5Etfw\"\n  }, \"June 22, 2020\")), \" \", mdx(\"script\", {\n    async: true,\n    src: \"https://platform.twitter.com/widgets.js\",\n    charSet: \"utf-8\"\n  }), mdx(\"p\", null, \"A core tenet of the Apple camp is that their complete ecosystem makes every product \\\"just work\\\". This is a truism: Apple isn't plagued with fragmentation issues like other platforms. But replicating these functionalities on other platforms isn't rocket science.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Fun fact: There are 1,300 brands with over 24,000 distinct Android devices (\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.android.com/everyone/\"\n  }), \"source\"), \").\\n\", mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"842px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"71.25%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7BAAAOwQG4kWvtAAADSElEQVQozwXBWW/aBgAAYP+P/Y0+bNrDNGlTV63VpGVbo1QVWxuS0NBAEsJ9GAinHYNt8FmMwTg2lMTmsDlGyAFNm6B2WpaonXrSdFulqdK6aNrDHrLvA04Pxi+2T9Su6V5u4p3rkj19bcY4a4eGZbAhVr9KcMLgsD2qrWgiNOrFN8TwYKB0iogOp1/qOWC88+qp9kth49M2euGt+aPr7k+uXL445VEEZsg31j6DcIa80Q1O0egyvRquur1sDKwybh1x6qkIsF/u9ZgNOj1VLZpG/SzonothH38IfQtBzXFvht6J11ATHgqSQVehkA2b7dgts1oslspxng0AhNsTuWmgzRMEEhS7ZWsEj8WtjojBYKv3E59zFdDh9bhv5VlCdLsyCQfFxAIQ7s9gvl2RA2DHCmy+et78QCbhOf/P3yQfLc7ID+a/vOajjBdnclACA4Pwkj8ZRlPOOJFbXMRQ8HtrPR0a8hTQcdxZ/yG05vq64PRwc3g4Dzerwy2pQdoQfnVyLzSt2oxS1i/C5IkYzboWCrHEfYlp+pxrEg/0bZ36nODx2i4sGC97r8Z6tt2R1nh4+Pchtj2wDPPRVjJW5UEFjY3XnSWY28hwfTSiFbkcpwIrt/WUO/363uTEpC8zIdfvRFT2Si3l1OxBLAmzt62FRIbDSInMlwJ2ppQr0et3yWy7gO9XS4AFfAAlKse6bRmka+UMjZhKBrCVzWJRS3AB7d4NU8lEkw+ra8EfM6Z2BiqiKZagFRFpVTCA17Z5jVf6fEn+aROetkoVpqEJNNj2EW2F6rLJ+9gygackAnkoOeoslEsnGBRXSvEtSQCaqB6VOR01arM3jvakeYy5BF9fcnxHOlPpEFEj6AqSwjGeIYV2yq8IGW2dUWWiylL1zSbQ6tS8POIK3OxEvtjZmqcUb4AxmKNLrYJDWmWl1aVNcpmJMxSfkqi4TnFNAa/JoiqInVoZIJEBOKtyaB1tdxxTTjzimqaSFksk4UceHw0e9SqdhswGQzpmJlBM5xg5n63I+Z4ijfo6cKwOFHGvmMsJQhryM8fa7p9nvx8cHu0fPH//3/k/5+dn7/99c/Lsya+Pn4yf/fb6xavnT/84ffn2zenZX+/+B/c89kTnnKkWAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Android device fragmentation\",\n    \"title\": \"Android device fragmentation\",\n    \"src\": \"/static/7eab0b404e51d4946136d3c74bb0f897/331a7/android_device_fragmentation.png\",\n    \"srcSet\": [\"/static/7eab0b404e51d4946136d3c74bb0f897/5243c/android_device_fragmentation.png 240w\", \"/static/7eab0b404e51d4946136d3c74bb0f897/ab158/android_device_fragmentation.png 480w\", \"/static/7eab0b404e51d4946136d3c74bb0f897/331a7/android_device_fragmentation.png 842w\"],\n    \"sizes\": \"(max-width: 842px) 100vw, 842px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"))), mdx(\"h2\", null, \"Terminology\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Peripheral\"), \": Refers to Bluetooth audio devices, keyboards, mice. Eg: headphones, headsets, earbuds, etc.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Host\"), \": Refers to a machine capable of connecting to a peripheral. Eg: phones, tablets, laptops, etc.\")), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/ab54ddefd78ccee213ba59f61935f8d2/hosts_and_periherals.svg\",\n    \"alt\": \"Hosts & Peripherals\"\n  }))), mdx(\"h2\", null, \"Overview\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"PCAS (Peripheral Connection Augmentation System)\"), \" artificially augments a Bluetooth peripheral maximum number of concurrent connections. Based on user-initiated events and hardware configurations PCAS automatically connects/disconnects a profile on a peripheral. PCAS can also multiplex to a single sink: For example, on Android, this brings the theoretical maximum audio connections to 30 (\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://groups.google.com/g/android-platform/c/_tmA8DRg8q4\"\n  }), \"the maximum allowed AudioTrack instances\"), \").\"), mdx(\"p\", null, \"A single user with multiple hosts no longer has to manually connect/disconnect each peripheral. PCAS does this automatically. This works even on cheap peripherals that don't support multiple concurrent connections natively. Example scenarios:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"When a call comes in on your phone while watching a movie on your tablet. The movie is automatically paused and your phone is connected.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"When playing music from multiple devices, the output could be muxed to the same audio sink in realtime.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Putting your laptop to sleep while powering on your desktop will connect your keyboard/mouse to your desktop.\")), mdx(\"p\", null, \"...\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/87eedac11aaec69de64cf478122ec310/multiplatform_modules.svg\",\n    \"alt\": \"Multiplatform modules\"\n  }))), mdx(\"h3\", null, \"Building\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"pcas-libs\"), \": This is a KMP Gradle project. The clients use the artifacts generated from this project. Run the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"publish_local.sh\"), \" script to publish the library artifacts to your maven local repository.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"pcas-clients/pcas-android-client\"), \": This is an Android Gradle project.\")), mdx(\"p\", null, \"You can find prebuilt binaries in the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Elvis10ten/pcas/releases\"\n  }), \"repo releases section\"), \".\"), mdx(\"h3\", null, \"Design Goals\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Multi-platform\"), \" (Windows, Mac, iOS, Android).\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Supports \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"most\"), \" Bluetooth peripheral (including and especially low-end peripherals).\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Average switching latency should be \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"< 1s\"), \".\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Can support at least \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"10 devices\"), \" without any service degradation.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Secure zero-config offline P2P\"), \" communication.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Negligible \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"power consumption\"), \".\")), mdx(\"h3\", null, \"Product\"), mdx(\"p\", null, \"PCAS is designed to be simple and \\\"just work\\\". The only initial setup required is selecting a peripheral for each service of interest.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/465fbe0fe31d9a3738663e8988ea2d2f/be4f4/screen_home_and_select_peripheral.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"103.75000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACaUlEQVQ4y52U247aQAyGeUlW4hACCQR4kd70JRAChIS4qNTH4LLco7LLKYSQcAgLSf6OHWYalkOljvQLZ4i/8dixM+PxGJPJhOU4DhaLBZbLJWzbxnq9xmw2w2g0Qj6fRy6XQ6lUYmmaxpJ2oVBANptFxnVdpNdqtWJYevm+j1qthnq9zrIsiyHFYlHtN5tNVCoVZAhAK4oixHEsfkNEYXi1I/6PIjdNk53TqqZsOkTXdWRkNHGcOOP0noj2rsDNZqOAliUAloiyWoJlFsRzXUVZLpfvgcHBxXG/UVE/AlI0VVNH1dDYfgKMcblc4GxccUVX2GfeuwdaLMMwUTGM18BHegRMg2UOHwMRq8ry0z+A9VfA6JpDJ9jCPr7KYRJZ2axAM/TnV5bOC9/G3F89BdZEUeqislqlhLxeYPvplWl5Ww++0KsrJ0UxWP9dFHJsNBoPJTuFDvgC/NtuZEsgdQr1MonaTbadtKmPyX57e0sXJXH2gxheEN+kgXq53W5jMBig3++j0+mg1+uh2+2yTXvD4RCtVitdlMT5w40w3YQ3wNPphP1+z/bhcMB0OsV8PsdMaPp7ygfKg++Kst/tsNv5N3tBEPAoO5/P7EQTiqfSyobtOvA8j7uMDnmQw4gVfwFut1uVX4rSEYVy7DVWR+/6dpJrBQz5m4sx/gB+vSe9EqWAcm7Kb5Og8qpyj26h5mEYJpF9/3nGtx9nti+XkGHkLIEUdSjmJU12muaUhvTcVBFSDjiHhwC7faAio/wcj0cFDK/Dl0Ck9CCmtGQoTOmcgMWLn5+qQORAVZY5JIgEyyDI5i4Th/8BYax3nMT5uqQAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Home and select peripheral screenshots\",\n    \"title\": \"Home and select peripheral screenshots\",\n    \"src\": \"/static/465fbe0fe31d9a3738663e8988ea2d2f/7d769/screen_home_and_select_peripheral.png\",\n    \"srcSet\": [\"/static/465fbe0fe31d9a3738663e8988ea2d2f/5243c/screen_home_and_select_peripheral.png 240w\", \"/static/465fbe0fe31d9a3738663e8988ea2d2f/ab158/screen_home_and_select_peripheral.png 480w\", \"/static/465fbe0fe31d9a3738663e8988ea2d2f/7d769/screen_home_and_select_peripheral.png 960w\", \"/static/465fbe0fe31d9a3738663e8988ea2d2f/87339/screen_home_and_select_peripheral.png 1440w\", \"/static/465fbe0fe31d9a3738663e8988ea2d2f/88b03/screen_home_and_select_peripheral.png 1920w\", \"/static/465fbe0fe31d9a3738663e8988ea2d2f/be4f4/screen_home_and_select_peripheral.png 2155w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"All hosts \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"must\"), \" be on the same LAN. E2E encryption is provided but optional (disabled by default). To enable E2E encryption, a key needs to be created and shared with the relevant hosts.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4a5df66a9725b5eac8add28cd31eb00b/68106/screen_encryption_setup_and_code_share.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"105%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAADHUlEQVQ4y4VTSU9aURTmF7Wr7ty226aNQ0R8oMyhSty7MU268gc0aZsUExOHRGPcVZMuuikOdQg4AFrm4QHCY3IA/HrPwUsBqb3Jl/fdc7/z3XPPfVc3PDyM0dFRhtFoxPj4OENRFMbY2BgGBwcxMjLCGr1e/0/d0NAQdLTodDpht9ths9naQuIUczgcsFgsmJiYYN6pIyOpk1qdDFqt1g5Y2pzWJicnuaqndBJsSO4csIndzWMM4p2GJpOpR6dvaaWunyElmydNwuBvNf0MWzojazurJt5lSL1SxNEUxcicBL2GNGed0q3rf+Q+6Gf4FHp6aIWdbo12tHUbko7mZrOZYTFbGMxFlRKPemg0m6D09JCS6Ds9PY2pqSm4p91wvHPC4XLC7XZzTKLL0C5uzDChwGAaZy775XK54PP5cHV1hUQigVAohNPzU5wHA8zT6TQymQzjUYUmo4n7JedkSDtns1nIEQgEsL+3j8PDQwSDQXQOHSXLl9IL+vPlUZPJZDtpc3MTc3NzmJ2dxfb2NscajQaazSZ09P7oGdFblM9OwmAw8NulKlOpVNtwa2sL8/PzmJmZYXNpeH9/D53H48HGxgbW19exsrKCpaUlLC8vM6cYYW1trevIXq8XCwsLWFxcxMHBQfeRS6USk3q9DlVVuemqmuUGy0G7a5rGlxKNRnktl8ujWCyKb44vhdbZMJVKo1qriR6lEIlEkRZHS8TjiMZiyOXzKJcroE3JrFAoci9/X14iGomIzeMiJ8JrpXIZDephPpftKrlyB1Tv7rtiN9c1UU2hPa/WgZpA+bbF24N6mMxkOVi+Ece6aUKtNpEVKAleuW3yBlqlBjVfYJ123YBaabYgdDkByisL7XVdVPjhWxzPP5cx8LWIl4saXq+U8Ha1xHzAo+HZpxI+eguY/55u6TxFvBJrb1ZbulcPuhdfinj/owqdP65hRwV2xR3sPXwl30kDPwViWgOBTBXe/+iiVXEpx792kYmGED73QY2JZodOEA60+MXJERIXZwie+eE/PkAqHEAk4G/pgg+6uNCdHiEm8uLhEP4AFbmswb+m6kgAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Encyrption setup and codeshare screenshots\",\n    \"title\": \"Encyrption setup and codeshare screenshots\",\n    \"src\": \"/static/4a5df66a9725b5eac8add28cd31eb00b/7d769/screen_encryption_setup_and_code_share.png\",\n    \"srcSet\": [\"/static/4a5df66a9725b5eac8add28cd31eb00b/5243c/screen_encryption_setup_and_code_share.png 240w\", \"/static/4a5df66a9725b5eac8add28cd31eb00b/ab158/screen_encryption_setup_and_code_share.png 480w\", \"/static/4a5df66a9725b5eac8add28cd31eb00b/7d769/screen_encryption_setup_and_code_share.png 960w\", \"/static/4a5df66a9725b5eac8add28cd31eb00b/87339/screen_encryption_setup_and_code_share.png 1440w\", \"/static/4a5df66a9725b5eac8add28cd31eb00b/88b03/screen_encryption_setup_and_code_share.png 1920w\", \"/static/4a5df66a9725b5eac8add28cd31eb00b/68106/screen_encryption_setup_and_code_share.png 2184w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"h4\", null, \"Assumptions\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Users have at most one peripheral per service. This assumption simplifies the UX and technical design.\")), mdx(\"h4\", null, \"Demo\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.youtube.com/watch?v=WMmtQLNYF-g/\"\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"57.91666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAADPklEQVQozz2Ta0zbZRSHq5lGg3FTZxjTAS290XJpQ7tO3YXhlM6tY06YJMTE6CQkfjCykIiXkCxx8dM+EOSLGsBNZI5tGDcJQog4VzNwDgRGL4Oum6UsDOnl3wu97PGlzJ3k5Jz3kifnd97zyhCWSt9DkkKkksnVJV6/nysTE0ihMLFoTOynSa4kRUzhn1/g+OfHaWhooLm5mZaWY3zYeJQj79UzOjqGLJ2KiMshfAtBglKYNCmuORx839+PFImzHAiRiCUIiTyRSOOacaHR6DAUa3iz5iCV+2s5VFfNw+se4dTJ75Al40FWPRCBcDRCJBHB5fXSf9nOPVHtkoCtxFJE4klEobhveNi5Yyfr129ALleg0xWRm5tHVtYT9PaeRZYQMmLxOH6/T8iWMpLdt24x9NtlAkGJ+cVF4sElpOUAwVCUq1PXeWXPa2RvUpIv16MoKCY3r5Cnn9nCufM/IrNaa6itPUJVVR1vHHqLgyK+/0ETXT2nGf3DTvfPVznR52ZkzIl3bo6hwUEqra+jUG5FU7gNlUZE3TZyntPQ1/cTsuxsPUVFu0RfXkCtspC7pYTdL9voOtnJ4O+TtA0HsHuhfeguk9MufhkY4NXKA+TJDQJmvu8msnNUa8B8uRmzeS8GQwUlpbtQKQzYat7h7Mgw0547fG1fYdiVpNMucfffINNTkwJYJYBGNFoLSvUadNNmDeczwHyTAFoxlFZgNJSjkpdiq6vn4tg1AosL/Pq3n65LSzhvL5NOxnG53OzbV50BaoVUpdqUqfABsExvZLulHLNxOy9uLaek0IT18Lv0XbrC7TkP3lk3ifAScTFS8dgKszfc7LfVUCDaoy/egVq7Ci0TQPWa5M0b89EojSi0ZSgVJeRslGPZU033wAi+mzeZEq/qn79DUMxjJCThmJzCduAw8gITOv1LaAvvAzM9vIDsy/ZOOr7ppr2+ha/aOjj1bQ+ffdHGiY4fiIUlfD4/USkmhj9FNBpn7K8/2V1ewUPrHkX57PO8nWfhyQ1P8fhjWZw504uM/23E8SD1/OOn59xFPLOzXJ+ewelw4phxiuhifHyC1tZWGo828knzxxz76NPMF2xqahJn4/wHYr6I6C1yP6QAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Watch demo\",\n    \"title\": \"Watch demo\",\n    \"src\": \"/static/4411ac19aba18957300860f0039a9891/7d769/demo_preview_with_play.png\",\n    \"srcSet\": [\"/static/4411ac19aba18957300860f0039a9891/5243c/demo_preview_with_play.png 240w\", \"/static/4411ac19aba18957300860f0039a9891/ab158/demo_preview_with_play.png 480w\", \"/static/4411ac19aba18957300860f0039a9891/7d769/demo_preview_with_play.png 960w\", \"/static/4411ac19aba18957300860f0039a9891/7c474/demo_preview_with_play.png 1329w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"))), mdx(\"h2\", null, \"Architecture\"), mdx(\"p\", null, \"Building PCAS for all platforms is hard, but the underlying concept is quite simple:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Each host observes local state changes.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"When a local change occurs, a host broadcasts it to a closed network of peers.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Each host listens for broadcasts from peers.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Each host writes all state information to its local ledger.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Each host independently makes a decision to connect/disconnect/stream based on the content of its ledger.\")), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/30d188974f34b50bf386ee7305cdcb90/architecture_highlevel.svg\",\n    \"alt\": \"High level architecture\"\n  }))), mdx(\"h3\", null, \"Unreliable Zero-Config Transport\"), mdx(\"p\", null, \"This base layer provides a framework for fast, best-effort, \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Zero-configuration_networking\"\n  }), \"zero-configuration\"), \", & E2E encrypted communication among devices within proximity.\"), mdx(\"p\", null, \"This allows a host to be able to efficiently & securely send and receive messages from other nearby devices without any upfront configuration.\"), mdx(\"p\", null, \"The \\\"unreliable\\\" prefix is misleading, just like when people say UDP is unreliable. This layer is just as reliable as the network stack below it; No additional reliability guarantees are provided.\"), mdx(\"p\", null, \"The transport data unit is a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"parcel\"), \". Parcels are just opaque byte buffers.\"), mdx(\"p\", null, \"This layer is made of three core components:\"), mdx(\"h4\", null, \"i. MulticastChannel\"), mdx(\"p\", null, \"This channel uses \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/IP_multicast\"\n  }), \"IP multicast\"), \" to efficiently deliver parcels to multiple devices.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/ecf1999a430599d3fca98b1022d4e879/multicast.svg\",\n    \"alt\": \"./PCAS1.svg\"\n  }))), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=MulticastChannel.kt\"\n  }), \"internal interface MulticastChannel {\\n\\n    @Throws(Exception::class)\\n    fun init(receiver: MessageReceiver)\\n\\n    @Throws(Exception::class)\\n    fun send(parcel: ByteArray, size: Int)\\n\\n    fun close()\\n}\\n\")), mdx(\"p\", null, \"All hosts can send a parcel to the PCAS multicast group and can join the group to receive parcels. The local IP addresses of discrete hosts are not required. The multicast configs can be found in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"TransportConfig\"), \" class:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=TransportConfig.kt\"\n  }), \"internal object TransportConfig {\\n\\n    // Max possible TTL value: Parcels could potentially leak to the internet.\\n    const val MULTICAST_TTL = 255\\n    const val MULTICAST_PORT = 49137\\n    val MULTICAST_ADDRESS = Address.Ipv4(\\\"225.139.089.176\\\")\\n\\n    const val OFFSET_ZERO = 0\\n\\n    const val MAX_PARCEL_SIZE_BYTES = 24 * 1024 // 24KB\\n    const val PARCEL_POOL_CAPACITY = 24\\n}\\n\")), mdx(\"h4\", null, \"ii. UnicastChannel\"), mdx(\"p\", null, \"This channel uses \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Unicast\"\n  }), \"IP unicast\"), \" to offer a high-bandwidth point-to-point communication. This is used for data streaming as multicast has a lower data transfer rate.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/bf381c82a87153a1475927489298a217/unicast.svg\",\n    \"alt\": \"./PCAS1.svg\"\n  }))), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=UnicastChannel.kt\"\n  }), \"internal interface UnicastChannel {\\n\\n    @Throws(Exception::class)\\n    fun init(receiver: MessageReceiver)\\n\\n    @Throws(Exception::class)\\n    fun send(recipient: HostInfo, parcel: ByteArray, size: Int)\\n\\n    @Throws(Exception::class)\\n    fun getPort(): Port\\n\\n    fun close()\\n}\\n\")), mdx(\"h4\", null, \"iii. Parceler\"), mdx(\"p\", null, \"This component adds E2E encryption to the two channels above. Encryption is optional and is only activated when an encryption key is generated or shared.\"), mdx(\"p\", null, \"Data is encrypted with AES in GCM mode with no padding. A random initialization vector is used once per message and prepended to the head of a parcel. I won't go into details here as there are lots of good material on AES encryption on the internet: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://levelup.gitconnected.com/doing-aes-gcm-in-android-adventures-in-the-field-72617401269d\"\n  }), \"like this one\"), \".\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/6e39cacdef88480e5ca6bd19bba83cda/transport_data_flow.svg\",\n    \"alt\": \"Transport data flow\"\n  }))), mdx(\"p\", null, \"An interface is created for the 3 components above in the common module which is implemented natively on each platform.\"), mdx(\"h3\", null, \"Immutable Distributed Ledger\"), mdx(\"p\", null, \"This layer is broadly split into two:\"), mdx(\"h4\", null, \"i. Storage\"), mdx(\"p\", null, \"A ledger is just a simple in-memory local database made up of blocks. Blocks represent the current state of the active hosts in a network. Each block is uniquely identified by a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"4-tuple (service, profile, owner, peripheral)\"), \".\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/a0ca3a25bee5d13e464f6034723b4f58/example_ledger.svg\",\n    \"alt\": \"Example local ledger\"\n  }))), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=Ledger.kt\"\n  }), \"data class Ledger(\\n    val self: HostInfo,\\n    val blocks: Set<Block> = emptySet()\\n)\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=Block.kt\"\n  }), \"data class Block(\\n    val service: Service,\\n    val profile: Service.Profile,\\n    val peripheral: Peripheral,\\n    val priority: Int,\\n    val timestamp: Long,\\n    val bondSteadyState: PeripheralBond.State,\\n    val owner: HostInfo,\\n    val canStreamData: Boolean,\\n    val canHandleDataStream: Boolean\\n)\\n\")), mdx(\"p\", null, \"\\\"immutable\\\" isn't technically correct. Blocks can be overwritten ONLY by their \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"owner\"), \". Any host can prune their ledgers to remove blocks from inactive hosts.\"), mdx(\"h4\", null, \"ii. Network Protocol\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/6f313478de0bc454df9472fc69031b53/7431b/network.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"57.50000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHuzRKF/8QAFxAAAwEAAAAAAAAAAAAAAAAAEBEhAP/aAAgBAQABBQLUKof/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAADAQEBAQAAAAAAAAAAAAAAARExIUFx/9oACAEBAAE/IW514KLr+izp6ESCUUP/2gAMAwEAAgADAAAAEOQP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQADAAMAAAAAAAAAAAAAAREAITFBUaH/2gAIAQEAAT8QZvGWncgBSUV8ykQDNzACtqSXWbm27594ADhrP//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Host Network\",\n    \"title\": \"Host Network\",\n    \"src\": \"/static/6f313478de0bc454df9472fc69031b53/18e3b/network.jpg\",\n    \"srcSet\": [\"/static/6f313478de0bc454df9472fc69031b53/46946/network.jpg 240w\", \"/static/6f313478de0bc454df9472fc69031b53/55489/network.jpg 480w\", \"/static/6f313478de0bc454df9472fc69031b53/18e3b/network.jpg 960w\", \"/static/6f313478de0bc454df9472fc69031b53/60e21/network.jpg 1440w\", \"/static/6f313478de0bc454df9472fc69031b53/69b48/network.jpg 1920w\", \"/static/6f313478de0bc454df9472fc69031b53/7431b/network.jpg 1954w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"), \"\\nA resilient multicast protocol is built on top of the transport layer. There are three types of messages:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Genesis\"), \": The first message a host sends, requesting other hosts to send their current blocks.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Update\"), \": This is sent each time the blocks on a host changes.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Heartbeat\"), \": This is periodically sent. After multiple missed heartbeats, a host is deemed dead by its peers and all its block could be independently deleted on each ledger.\")), mdx(\"p\", null, \"Each host maintains its local ledger. The network protocol guarantees that eventually, all ledgers will be consistent.\"), mdx(\"h5\", null, \"Multicast Reliability\"), mdx(\"p\", null, \"Currently, only \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Update\"), \" messages are classified as essential.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Heartbeat\"), \" messages are used as a form of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Acknowledgement_(data_networks)\"\n  }), \"NACK\"), \". A host detects synchronization issues from heartbeats and resends its current blocks.\"), mdx(\"p\", null, \"While heartbeats are effective, the interval is too long to be relied on primarily for a highly interactive system like PCAS.\"), mdx(\"p\", null, \"Reliable multicasting is an interesting problem. I explored two strategies:\"), mdx(\"h6\", null, \"a. Using redundancy\"), mdx(\"p\", null, \"Blindly resend essential messages \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"x\"), \" times with a delay of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"y + random jitter\"), \" on each attempt.\"), mdx(\"p\", null, \"Let's consider a simple model. If the probability of successfully delivering a message is fixed at 0.50. Assuming each attempt is independent, there is a 0.97 probability that at least one message gets delivered in 5 attempts.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Napkin math\")), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Let b = 1 on success; 0 on failure\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Pr(b = 1) = 0.50\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Pr(b = 0) = 1 - Pr(b = 1) = 0.50\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"(b is a Bernoulli random variable)\"), mdx(\"hr\", {\n    parentName: \"blockquote\"\n  }), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"n = 5\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"z = n tries of b\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"(z is a Binomial random variable)\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"katex\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"katex-mathml\"\n  }), mdx(\"math\", _extends({\n    parentName: \"span\"\n  }, {\n    \"xmlns\": \"http://www.w3.org/1998/Math/MathML\"\n  }), mdx(\"semantics\", {\n    parentName: \"math\"\n  }, mdx(\"mrow\", {\n    parentName: \"semantics\"\n  }, mdx(\"mi\", {\n    parentName: \"mrow\"\n  }, \"P\"), mdx(\"mi\", {\n    parentName: \"mrow\"\n  }, \"r\"), mdx(\"mo\", _extends({\n    parentName: \"mrow\"\n  }, {\n    \"stretchy\": \"false\"\n  }), \"(\"), mdx(\"mn\", {\n    parentName: \"mrow\"\n  }, \"1\"), mdx(\"mo\", {\n    parentName: \"mrow\"\n  }, \"\\u2264\"), mdx(\"mi\", {\n    parentName: \"mrow\"\n  }, \"z\"), mdx(\"mo\", {\n    parentName: \"mrow\"\n  }, \"\\u2264\"), mdx(\"mi\", {\n    parentName: \"mrow\"\n  }, \"n\"), mdx(\"mo\", _extends({\n    parentName: \"mrow\"\n  }, {\n    \"stretchy\": \"false\"\n  }), \")\"), mdx(\"mo\", {\n    parentName: \"mrow\"\n  }, \"=\"), mdx(\"mstyle\", _extends({\n    parentName: \"mrow\"\n  }, {\n    \"scriptlevel\": \"0\",\n    \"displaystyle\": \"true\"\n  }), mdx(\"munderover\", {\n    parentName: \"mstyle\"\n  }, mdx(\"mo\", {\n    parentName: \"munderover\"\n  }, \"\\u2211\"), mdx(\"mrow\", {\n    parentName: \"munderover\"\n  }, mdx(\"mi\", {\n    parentName: \"mrow\"\n  }, \"i\"), mdx(\"mo\", {\n    parentName: \"mrow\"\n  }, \"=\"), mdx(\"mn\", {\n    parentName: \"mrow\"\n  }, \"1\")), mdx(\"mi\", {\n    parentName: \"munderover\"\n  }, \"n\")), mdx(\"mrow\", {\n    parentName: \"mstyle\"\n  }, mdx(\"mo\", _extends({\n    parentName: \"mrow\"\n  }, {\n    \"fence\": \"true\"\n  }), \"(\"), mdx(\"mstyle\", _extends({\n    parentName: \"mrow\"\n  }, {\n    \"displaystyle\": \"false\",\n    \"scriptlevel\": \"0\"\n  }), mdx(\"mfrac\", _extends({\n    parentName: \"mstyle\"\n  }, {\n    \"linethickness\": \"0px\"\n  }), mdx(\"mi\", {\n    parentName: \"mfrac\"\n  }, \"n\"), mdx(\"mi\", {\n    parentName: \"mfrac\"\n  }, \"i\"))), mdx(\"mo\", _extends({\n    parentName: \"mrow\"\n  }, {\n    \"fence\": \"true\"\n  }), \")\")), mdx(\"mi\", {\n    parentName: \"mstyle\"\n  }, \"P\"), mdx(\"mi\", {\n    parentName: \"mstyle\"\n  }, \"r\"), mdx(\"mo\", _extends({\n    parentName: \"mstyle\"\n  }, {\n    \"stretchy\": \"false\"\n  }), \"(\"), mdx(\"mi\", {\n    parentName: \"mstyle\"\n  }, \"b\"), mdx(\"mo\", {\n    parentName: \"mstyle\"\n  }, \"=\"), mdx(\"mn\", {\n    parentName: \"mstyle\"\n  }, \"1\"), mdx(\"msup\", {\n    parentName: \"mstyle\"\n  }, mdx(\"mo\", _extends({\n    parentName: \"msup\"\n  }, {\n    \"stretchy\": \"false\"\n  }), \")\"), mdx(\"mi\", {\n    parentName: \"msup\"\n  }, \"i\")), mdx(\"mi\", {\n    parentName: \"mstyle\"\n  }, \"P\"), mdx(\"mi\", {\n    parentName: \"mstyle\"\n  }, \"r\"), mdx(\"mo\", _extends({\n    parentName: \"mstyle\"\n  }, {\n    \"stretchy\": \"false\"\n  }), \"(\"), mdx(\"mi\", {\n    parentName: \"mstyle\"\n  }, \"b\"), mdx(\"mo\", {\n    parentName: \"mstyle\"\n  }, \"=\"), mdx(\"mn\", {\n    parentName: \"mstyle\"\n  }, \"0\"), mdx(\"msup\", {\n    parentName: \"mstyle\"\n  }, mdx(\"mo\", _extends({\n    parentName: \"msup\"\n  }, {\n    \"stretchy\": \"false\"\n  }), \")\"), mdx(\"mrow\", {\n    parentName: \"msup\"\n  }, mdx(\"mi\", {\n    parentName: \"mrow\"\n  }, \"n\"), mdx(\"mo\", {\n    parentName: \"mrow\"\n  }, \"\\u2212\"), mdx(\"mi\", {\n    parentName: \"mrow\"\n  }, \"i\"))))), mdx(\"annotation\", _extends({\n    parentName: \"semantics\"\n  }, {\n    \"encoding\": \"application/x-tex\"\n  }), \"Pr(1 \\\\leq z \\\\leq n) = \\\\displaystyle\\\\sum_{i=1}^n \\\\tbinom{n}{i} Pr(b = 1)^i Pr(b = 0)^{n - i}\")))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"katex-html\",\n    \"aria-hidden\": \"true\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"base\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"strut\",\n    \"style\": {\n      \"height\": \"1em\",\n      \"verticalAlign\": \"-0.25em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\",\n    \"style\": {\n      \"marginRight\": \"0.13889em\"\n    }\n  }), \"P\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\",\n    \"style\": {\n      \"marginRight\": \"0.02778em\"\n    }\n  }), \"r\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mopen\"\n  }), \"(\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord\"\n  }), \"1\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mrel\"\n  }), \"\\u2264\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  }))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"base\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"strut\",\n    \"style\": {\n      \"height\": \"0.7719400000000001em\",\n      \"verticalAlign\": \"-0.13597em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\",\n    \"style\": {\n      \"marginRight\": \"0.04398em\"\n    }\n  }), \"z\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mrel\"\n  }), \"\\u2264\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  }))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"base\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"strut\",\n    \"style\": {\n      \"height\": \"1em\",\n      \"verticalAlign\": \"-0.25em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\"\n  }), \"n\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mclose\"\n  }), \")\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mrel\"\n  }), \"=\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  }))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"base\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"strut\",\n    \"style\": {\n      \"height\": \"2.929066em\",\n      \"verticalAlign\": \"-1.277669em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mop op-limits\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-t vlist-t2\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-r\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist\",\n    \"style\": {\n      \"height\": \"1.6513970000000002em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"style\": {\n      \"top\": \"-1.872331em\",\n      \"marginLeft\": \"0em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"pstrut\",\n    \"style\": {\n      \"height\": \"3.05em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"sizing reset-size6 size3 mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal mtight\"\n  }), \"i\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mrel mtight\"\n  }), \"=\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mtight\"\n  }), \"1\")))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"style\": {\n      \"top\": \"-3.050005em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"pstrut\",\n    \"style\": {\n      \"height\": \"3.05em\"\n    }\n  })), mdx(\"span\", {\n    parentName: \"span\"\n  }, mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mop op-symbol large-op\"\n  }), \"\\u2211\"))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"style\": {\n      \"top\": \"-4.3000050000000005em\",\n      \"marginLeft\": \"0em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"pstrut\",\n    \"style\": {\n      \"height\": \"3.05em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"sizing reset-size6 size3 mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal mtight\"\n  }), \"n\")))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-s\"\n  }), \"\\u200B\")), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-r\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist\",\n    \"style\": {\n      \"height\": \"1.277669em\"\n    }\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }))))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.16666666666666666em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mopen delimcenter\",\n    \"style\": {\n      \"top\": \"0em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"delimsizing size1\"\n  }), \"(\")), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mfrac\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-t vlist-t2\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-r\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist\",\n    \"style\": {\n      \"height\": \"0.7453919999999999em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"style\": {\n      \"top\": \"-2.3550000000000004em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"pstrut\",\n    \"style\": {\n      \"height\": \"2.7em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"sizing reset-size6 size3 mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal mtight\"\n  }), \"i\")))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"style\": {\n      \"top\": \"-3.144em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"pstrut\",\n    \"style\": {\n      \"height\": \"2.7em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"sizing reset-size6 size3 mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal mtight\"\n  }), \"n\"))))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-s\"\n  }), \"\\u200B\")), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-r\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist\",\n    \"style\": {\n      \"height\": \"0.345em\"\n    }\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }))))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mclose delimcenter\",\n    \"style\": {\n      \"top\": \"0em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"delimsizing size1\"\n  }), \")\"))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\",\n    \"style\": {\n      \"marginRight\": \"0.13889em\"\n    }\n  }), \"P\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\",\n    \"style\": {\n      \"marginRight\": \"0.02778em\"\n    }\n  }), \"r\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mopen\"\n  }), \"(\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\"\n  }), \"b\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mrel\"\n  }), \"=\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  }))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"base\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"strut\",\n    \"style\": {\n      \"height\": \"1.1246639999999999em\",\n      \"verticalAlign\": \"-0.25em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord\"\n  }), \"1\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mclose\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mclose\"\n  }), \")\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"msupsub\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-t\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-r\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist\",\n    \"style\": {\n      \"height\": \"0.8746639999999999em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"style\": {\n      \"top\": \"-3.113em\",\n      \"marginRight\": \"0.05em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"pstrut\",\n    \"style\": {\n      \"height\": \"2.7em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"sizing reset-size6 size3 mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal mtight\"\n  }), \"i\")))))))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\",\n    \"style\": {\n      \"marginRight\": \"0.13889em\"\n    }\n  }), \"P\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\",\n    \"style\": {\n      \"marginRight\": \"0.02778em\"\n    }\n  }), \"r\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mopen\"\n  }), \"(\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal\"\n  }), \"b\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mrel\"\n  }), \"=\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mspace\",\n    \"style\": {\n      \"marginRight\": \"0.2777777777777778em\"\n    }\n  }))), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"base\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"strut\",\n    \"style\": {\n      \"height\": \"1.124664em\",\n      \"verticalAlign\": \"-0.25em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord\"\n  }), \"0\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mclose\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mclose\"\n  }), \")\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"msupsub\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-t\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist-r\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"vlist\",\n    \"style\": {\n      \"height\": \"0.874664em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"style\": {\n      \"top\": \"-3.113em\",\n      \"marginRight\": \"0.05em\"\n    }\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"pstrut\",\n    \"style\": {\n      \"height\": \"2.7em\"\n    }\n  })), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"sizing reset-size6 size3 mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mtight\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal mtight\"\n  }), \"n\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mbin mtight\"\n  }), \"\\u2212\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"mord mathnormal mtight\"\n  }), \"i\"))))))))))))), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Could also be calculated as 1 - Pr(z = 0)\")), mdx(\"p\", null, \"In practice, delivery probabilities aren't fixed and attempts are not independent. Despite the shortcoming of this strategy, it has the following benefits:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"It isn't dependent on the size of the network. Whether there are 2 or 10,000 peers, a host will only send its messages at a rate of \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"c / second\"), \".\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Peers that are just entering the network could benefit from these redundant messages.\")), mdx(\"h6\", null, \"b. Using ACKs\"), mdx(\"p\", null, \"Essential messages have a monotonically increasing sequence number. The initial sequence number is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"0\"), \". All hosts are expected to send an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Ack\"), \" message with the sequence number of the essential message. Retries are done with a truncated exponential backoff with jitter.\"), mdx(\"p\", null, \"This strategy only sends fewer messages (more efficient) than the redundant strategy when the number of peers in a network is less than \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"x\"), \". Some issues with this strategy:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Using \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"ACKs\"), \" like TCP isn't scalable and runs the risk of \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://courses.cs.washington.edu/courses/cse561/01sp/lectures/568.multicast2.pdf\"\n  }), \"ACKs implosion\"), \".\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The number of messages sent is dependent on the size of the network. A single rogue peer can cause the network to be spammed with ACKs and messages.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Figuring out which peer to expect ACKs from is complex.\")), mdx(\"p\", null, \"I initially went with ACKs but will be using the simple redundant strategy instead.\"), mdx(\"p\", null, \"The network protocol data unit is a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Message\"), \". Messages are marshaled to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Protobuf\"), \" format and passed to the transport layer. The inverse happens when a message is received.\"), mdx(\"h3\", null, \"Resource Allocation\"), mdx(\"p\", null, \"When two or more hosts use the same \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"3-tuple(service, profile, peripheral)\"), \", a contention occurs. Even if a host doesn't actively require a profile, it can still contend with another host for that profile.\"), mdx(\"p\", null, \"This is the meat or vegetable (for my vegetarian friends) of the system.\"), mdx(\"h4\", null, \"Bluetooth Profiles\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"A Bluetooth profile is a specification regarding an aspect of Bluetooth-based wireless communication between devices. It resides on top of the Bluetooth Core Specification and (optionally) additional protocols - \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/List_of_Bluetooth_profiles\"\n  }), \"source\"))), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"A2DP (Advanced Audio Distribution Profile)\"), \": This is a uni-directional audio profile and provides better audio quality than the headset profiles.\\n\", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.slideshare.net/Thenmurugeshwari/bluetooth-profile\"\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"728px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"75%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAe5EBaCNf//EABsQAAIBBQAAAAAAAAAAAAAAAAIRAQASEyEx/9oACAEBAAEFAnty5pFeiyF3/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AdR//8QAFREBAQAAAAAAAAAAAAAAAAAAAAH/2gAIAQIBAT8BV//EABYQAQEBAAAAAAAAAAAAAAAAABBhAP/aAAgBAQAGPwJmh//EABsQAAIDAAMAAAAAAAAAAAAAAAARASExQVFh/9oACAEBAAE/IeCyY1ixqeo2rXZMzrR4H//aAAwDAQACAAMAAAAQb+//xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8Qhh//xAAYEQACAwAAAAAAAAAAAAAAAAAAAREhUf/aAAgBAgEBPxCHo1n/xAAbEAEBAAIDAQAAAAAAAAAAAAABEQAhMWFxsf/aAAgBAQABPxAuiKw2Y4KLDcfmNUZyFuAzDv8AGAJkW04mJ8DXef/Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"A2DP profile\",\n    \"title\": \"A2DP profile\",\n    \"src\": \"/static/9bbcc7781113c7395d86f249b678bcf8/9bc41/a2dp_profile.jpg\",\n    \"srcSet\": [\"/static/9bbcc7781113c7395d86f249b678bcf8/46946/a2dp_profile.jpg 240w\", \"/static/9bbcc7781113c7395d86f249b678bcf8/55489/a2dp_profile.jpg 480w\", \"/static/9bbcc7781113c7395d86f249b678bcf8/9bc41/a2dp_profile.jpg 728w\"],\n    \"sizes\": \"(max-width: 728px) 100vw, 728px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Headset (Headset Profile/Hands-Free Profile)\"), \": These are bi-directional audio profiles usually used for phone calls.\\n\", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.slideshare.net/Thenmurugeshwari/bluetooth-profile\"\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"728px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"75%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAED/9oADAMBAAIQAxAAAAHbUUlCJ1//xAAbEAACAQUAAAAAAAAAAAAAAAABAgAREiEiMf/aAAgBAQABBQImkuy0KsSU2bv/xAAVEQEBAAAAAAAAAAAAAAAAAAAAAf/aAAgBAwEBPwFH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAABARMf/aAAgBAQAGPwIi0tX/xAAbEAEAAgIDAAAAAAAAAAAAAAABAEERITFhgf/aAAgBAQABPyFVfkUask5TWsCImqp0T//aAAwDAQACAAMAAAAQdO//xAAYEQACAwAAAAAAAAAAAAAAAAAAARExQf/aAAgBAwEBPxCXpQ//xAAYEQACAwAAAAAAAAAAAAAAAAAAARExYf/aAAgBAgEBPxCNHZ//xAAbEAADAQADAQAAAAAAAAAAAAABESEAMWFx0f/aAAgBAQABPxBYRg9PmB6Cp5uofMZlEZVMHShGnKxHwE73/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"A2DP profile\",\n    \"title\": \"A2DP profile\",\n    \"src\": \"/static/9d1aa6daa31891489cb2867a59539e7a/9bc41/hfp_profile.jpg\",\n    \"srcSet\": [\"/static/9d1aa6daa31891489cb2867a59539e7a/46946/hfp_profile.jpg 240w\", \"/static/9d1aa6daa31891489cb2867a59539e7a/55489/hfp_profile.jpg 480w\", \"/static/9d1aa6daa31891489cb2867a59539e7a/9bc41/hfp_profile.jpg 728w\"],\n    \"sizes\": \"(max-width: 728px) 100vw, 728px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"HID (Human Interface Device Profile)\"), \": Provides support for devices such as mice, keyboards, etc. PlayStation 3 controllers and Wii remotes also use Bluetooth HID.\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Recap: With A2DP you can only listen but with higher audio quality. With headset profiles, you can talk and listen, but at a lower quality. Next time you are playing a song while a call comes in, observe how the audio quality drops.\")), mdx(\"p\", null, \"Each time a change is made to the ledger, a resolver looks at all the current contentions and resolves them.\"), mdx(\"h4\", null, \"Type of resolutions\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Connect\"), \": The host should connect to the profile on the peripheral if disconnected.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Disconnect\"), \": The host should disconnect from the profile on the peripheral if connected.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Stream\"), \": The host should start sending all its data to the specified remote host.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Ambiguous\"), \": No resolution was arrived at. The system should be kept as-is.\")), mdx(\"p\", null, \"Resolutions are derived using a rank associated with each block.\"), mdx(\"h4\", null, \"Calculating ranks\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=Ranking.kt\"\n  }), \"    val isConnected = bondSteadyState == PeripheralBond.State.CONNECTED\\n\\n    val hasPriority = priority != NO_PRIORITY\\n\\n    val maxPossibleConnectionAndInteractiveScore = 4 + 2\\n    // Any device with a higher priority should always rank higher.\\n    val priorityScore = (maxPossibleConnectionAndInteractiveScore + 1.0).pow(priority)\\n\\n    private val connectionScore: Int get() {\\n        // Connection should contribute more if we can't stream\\n        val trueValue = if(canStreamData) 2 else 4\\n        return if(isConnected) trueValue else 1\\n    }\\n\\n    val interactiveScore = if(owner.isInteractive) 2 else 1\\n\\n    val timestampScore = log10(timestamp.toDouble())\\n\\n    val rank = priorityScore + connectionScore + interactiveScore + timestampScore\\n\")), mdx(\"p\", null, \"The rank is an estimate of the current importance of a block. Based on ranks, a contention object is created for each block a host has.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=Contention.kt\"\n  }), \"data class Contention(\\n    val selfBlock: Block,\\n    // This is another block with the same service, peripheral, and profile but a different owner that is deemed the apex based on its rank\\n    val peersApexBlock: Block?\\n)\\n\")), mdx(\"p\", null, \"The contention object is then used to derive a resolution.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=Resolution.kt\"\n  }), \"fun getResolution(contention: Contention): Resolution {\\n    return when {\\n        // No contenders found yet.\\n        contention.peersApexBlock == null -> {\\n            Resolution.Connect(contention.selfBlock, contention.selfBlock.rank)\\n        }\\n\\n        // I have a higher rank: So connect to profile\\n        contention.selfBlock.rank > contention.peersApexBlock.rank -> {\\n            Resolution.Connect(contention.selfBlock, contention.selfBlock.rank)\\n        }\\n\\n        // I have a lower rank: So disconnect from profile - If connected\\n        contention.selfBlock.rank < contention.peersApexBlock.rank -> {\\n            val rank = contention.peersApexBlock.rank\\n            // If possible stream data to the apex host\\n            if(contention.shouldStreamToApex()) {\\n                Resolution.Stream(contention.selfBlock, rank, contention.peersApexBlock.owner)\\n            } else {\\n                Resolution.Disconnect(contention.selfBlock, rank)\\n            }\\n        }\\n\\n        // Nothing decided: Keep the system as-is.\\n        contention.selfBlock.rank == contention.peersApexBlock.rank -> {\\n            Resolution.Ambiguous(contention.selfBlock, contention.selfBlock.rank)\\n        }\\n\\n        else -> throw IllegalStateException(\\\"Impossible!\\\")\\n    }\\n}\\n\")), mdx(\"h3\", null, \"User Services\"), mdx(\"p\", null, \"Currently, only audio services are supported. Provision has been made to easily add other types of services.\"), mdx(\"h4\", null, \"Audio\"), mdx(\"p\", null, \"All services have two key integrants:\"), mdx(\"h5\", null, \"i. Blocks Emission\"), mdx(\"p\", null, \"Blocks are built from host state information. The relevant audio states are the current audio usages and the current peripheral bond state.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=AudioProperty.kt\"\n  }), \"data class AudioProperty(val usages: Set<Usage>) {\\n\\n    enum class Usage(\\n        val priority: Int,\\n        val profile: PeripheralProfile\\n    ) {\\n        UNKNOWN(1, PeripheralProfile.A2DP),\\n        // Unknown media playback. It could be music, movie soundtracks, etc.\\n        MEDIA_UNKNOWN(2, PeripheralProfile.A2DP),\\n        // Music playback, eg: Music streaming, local audio playback, etc.\\n        MUSIC(2, PeripheralProfile.A2DP),\\n        // Speech playback, eg: Podcasts, Audiobooks, etc\\n        SPEECH(2, PeripheralProfile.A2DP),\\n        // Soundtrack, typically accompanying a movie or TV program.\\n        MOVIE(4, PeripheralProfile.A2DP),\\n        // Game audio playback\\n        GAME(4, PeripheralProfile.A2DP),\\n        // Such as VoIP.\\n        VOICE_COMMUNICATION(5, PeripheralProfile.HEADSET),\\n        // Telephony call\\n        TELEPHONY_CALL(6, PeripheralProfile.HEADSET)\\n    }\\n}\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-kotlin:title=PeripheralBond.kt\"\n  }), \"data class PeripheralBond(\\n    val profile: PeripheralProfile,\\n    val hotState: State\\n) {\\n\\n    enum class State {\\n        CONNECTED,\\n        CONNECTING,\\n        DISCONNECTED,\\n        DISCONNECTING;\\n\\n        fun getSteadyState(): State {\\n            return when(this) {\\n                CONNECTED -> CONNECTED\\n                CONNECTING -> DISCONNECTED\\n                DISCONNECTED -> DISCONNECTED\\n                DISCONNECTING -> CONNECTED\\n            }\\n        }\\n    }\\n}\\n\")), mdx(\"p\", null, \"Each time a host state changes, a new block is created. The ledger layer listens for these changes and automatically updates the local ledger and sends the blocks to remote peers.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/632bba6efa9ebd5bf2f28a5083a52cd1/PCASBlocksEmitter.svg\",\n    \"alt\": \"Audio blocks sequence\"\n  }))), mdx(\"p\", null, \"ii. \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Resolution Handler\")), mdx(\"p\", null, \"Each service gets to handle all resolutions from the resource allocation layer. For audio, this is actually where we connect or disconnect the audio profiles on a peripheral. A service can also choose to support streaming, in which case it will also handle that resolution here.\"), mdx(\"h2\", null, \"FAQ\"), mdx(\"h3\", null, \"Why use IP Multicast?\"), mdx(\"p\", null, \"Multicast has issues: It requires all devices to be on the same network and it's blocked by some routers. PCAS was designed to be used in a \\\"home network\\\" where these issues are usually nonexistent.\"), mdx(\"p\", null, \"I explored 2 other possible technologies:\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.wi-fi.org/discover-wi-fi/wi-fi-aware\"\n  }), \"Wi-Fi Aware\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.wi-fi.org/discover-wi-fi/wi-fi-direct\"\n  }), \"Wi-Fi Direct\"), \" were not considered due to power consumption concerns. Google Nearby service was considered but quickly eliminated due to some unacceptable limitations.\")), mdx(\"h4\", null, \"1. Push Messaging\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/1c20674d716c45dd44cc822f855b2b0f/fcm.gif\",\n    \"alt\": \"./image1.gif\"\n  }))), mdx(\"p\", null, \"This is easy using a service like \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://firebase.google.com/docs/cloud-messaging\"\n  }), \"FCM\"), \" (it would be similar to Google \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developers.google.com/nearby/messages/overview\"\n  }), \"Nearby Messaging API\"), \" without the proximity part).\"), mdx(\"p\", null, \"FCM and other push messaging services work using long-lived TCP sockets. A TCP socket on the device waits in accept mode on a Google server.\"), mdx(\"h5\", null, \"Pros:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Simple.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Efficient: Delivery is only made to specific hosts.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Works well on Android in the background.\")), mdx(\"h5\", null, \"Cons:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Not P2P: Depends on a central server.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Not offline: Requires the internet.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Higher latency.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Increased attack surface: A local-only solution limits who can initiate an attack.\")), mdx(\"h3\", null, \"2. BLE (Bluetooth Low Energy) Advertisement\"), mdx(\"p\", null, \"BLE devices can broadcast advertisement packets unidirectionally. I will do a quick overview of BLE advertisement. You can read the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=229737\"\n  }), \"Bluetooth Core Specification v4.0\"), \" for more, or scroll to the pros & cons section to understand why it wasn't picked.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Physical Layer\")), mdx(\"p\", null, \"BLE uses the same \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/ISM_band\"\n  }), \"2.4Ghz ISM band\"), \" as classic Bluetooth and WiFi.\"), mdx(\"p\", null, \"It operates in the same spectrum range (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"2.400\\u20132.4835 GHz\"), \") as Classic Bluetooth but has \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"40 2-Mhz channels\"), \" as opposed to the classic \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"79 1-Mhz channels\"), \".\"), mdx(\"p\", null, \"Data is transmitted within a channel using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Frequency-shift_keying#Gaussian_frequency-shift_keying\"\n  }), \"Frequency Shift Keying\"), \".\"), mdx(\"p\", null, \"The data rate is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1 Mbps\"), \" (supporting 2Mbps on Bluetooth 5.0).\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Advertisement Packet\")), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/7c42004b6d9127c84fab13641517988c/7d769/ble-advertising-packet.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"37.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVQY002Q32vTUBTHr+AeZQ8OfJkgMtmzf4eIICg+CD4pnbVYFhFlg1ZG28lE0SkoaFOpcQtJsQq+tKzMDfwxynDD5m0PSTQ1ydImt0l68+ter0VhXw4cvud7PufhAPJfrutalgUh9DwviqIwDH3fRwgFQUDtcDikC9SSAwJJktDWbrcrlUq9Xq/VahzHMQyTzWYLhUKxWMzn86lUqlQq8TxPI1EU6S2KYIz/wV+/bT188lR4956tckuPHl+6fOX8hYuzNzO5+bmZa1fPnT1zm5ldeVPl33IivxqPYEqDrqYpirKv/8bQRJaGDDmwNDIwA2j96g00y+naruUh3fEU0/5pOYbjqft9rQd16IGpE8fHJ46dngAkPYZvHU3mTwZ3Jknm8MbMNMisjGVYkGaPMNWpvDh9TziVE8aZKrj+EqTLh26woMwJz16Un5fmwg+55OMC+VzGX1jSLMrNVwuNzv3GzmJjd7G5u/xJet2WuW1lqdV50JL+1toP4EvrSJUChPSeY9het+/qXqz6ZJAceCsemb11omwSbJPIIEijQ4DvTsatZRr6AzuMQhP6a5Iqm/0A+THGyaiiOKassLG1urm9Z8LvsrGjmp1u/w/P/HFCtacGZQAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"./ble-advertising-packet.png\",\n    \"title\": \"./ble-advertising-packet.png\",\n    \"src\": \"/static/7c42004b6d9127c84fab13641517988c/7d769/ble-advertising-packet.png\",\n    \"srcSet\": [\"/static/7c42004b6d9127c84fab13641517988c/5243c/ble-advertising-packet.png 240w\", \"/static/7c42004b6d9127c84fab13641517988c/ab158/ble-advertising-packet.png 480w\", \"/static/7c42004b6d9127c84fab13641517988c/7d769/ble-advertising-packet.png 960w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Advertising & Interference\")), mdx(\"p\", null, \"BLE is robust, using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Frequency-hopping_spread_spectrum\"\n  }), \"frequency hopping\"), \" to work around interference.\"), mdx(\"p\", null, \"BLE uses 3 dedicated channels for advertising: 37, 38, 39 (channels are zero-indexed). As can be seen in the image below, these channels are spread across the 2.4GHz band to minimize interference problems.\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.argenox.com/library/bluetooth-low-energy/ble-advertising-primer/\"\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"49.583333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAC9ElEQVQoz12RaUjTcRjHnzk3LbO85jZ1myYZ9KYX+SJQ85g57wPDwmP7z7M52aw554GZ1/xvs6mpLDxSi0plmdNS57zK2UGlsCUSaaloqW8k6kX05tc/QbA+8OU5+H7hgQeAgMVigVQqhQPoyRukrwN02q9nVCaaA1f0guSCTEDf6mccP489J3dqBCQ4RFNTE7DZbPgXhEDSoCMX16rtSqurKCBCJCbs2ZSAC0UCfhTCsG8rrau2lddqqIo6NfWaupUcP7a6nz0MnRBt0gbIGwDkg2WxrJYiJ+arAA7lAMe0AJT/ToAfADbdYZyDjDMAyQMaxaQjeY0aP/9FRPdE6ETS6Ge30M5pepky3YfbMcVwHv5IP25BtLCeOc8Ard6b2zXDjDduuLki5HR2BbkkDbx3jx5cYRQ21/g2JII9/NYDW2IyFGZXP6oskirrg/UWUWT/grjXIMm7OLubVXBdg8vENRre5JY0Zmi5iKe3FHPvv5JVCBXKXPxhacTkRnaI4VtuxXC7GI0ADX6OUs6U6Lt68EjsTWtQ9HLKnYneKON6Y7dR3pymM95rDUmw6AKirELt4z7e+FpnhGmzQ1yuG+w4F7ykieObE55Y2i483Wm+YdC1o0HgwN6ih78Wly2pw9N3WriJu9Kytk884/pE94TCWCKuWbnNTd5pDk/eqcgpX4kcXzPHGpZfKi+LvzRFpGy3hCZu5qkevA40fTdVG1rn0RCchO15un97Udrb+qjMBW1M6kJ5bsW7yNHVsbv9+VOVVwqsquhUKx6bYa1JzrHG9i+YL3VOm+uJWRnH/6DhpVhlklpz0MjW7E39rRnUR1wY7g32HAAPR6AyiDcxnYDsDqcDmRwGsJyA6mEH4El80IuQN9D8WODMYTkCsB2A7OMINuyjYOsJp4K8HNjOnGB3oEKGIMuXj2ENAkygFmDYvoT8DDWGCVVEj4vyRXixQoEXyeUqUV4ujgn4OJYpxDEhpsKEf6sQzxTw1ZgAq0rj57j8AapRJx53xPbxAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"./ble-advertising-channels-spectrum.png\",\n    \"title\": \"./ble-advertising-channels-spectrum.png\",\n    \"src\": \"/static/bf838ddfd71b66fc261b071d1064221d/7842b/ble-advertising-channels-spectrum.png\",\n    \"srcSet\": [\"/static/bf838ddfd71b66fc261b071d1064221d/5243c/ble-advertising-channels-spectrum.png 240w\", \"/static/bf838ddfd71b66fc261b071d1064221d/ab158/ble-advertising-channels-spectrum.png 480w\", \"/static/bf838ddfd71b66fc261b071d1064221d/7842b/ble-advertising-channels-spectrum.png 800w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"))), mdx(\"p\", null, \"A relevant study: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.researchgate.net/publication/265602069_Coexistence_and_Interference_Tests_on_a_Bluetooth_Low_Energy_Front-End\"\n  }), \"Coexistence and Interference Tests on a Bluetooth Low Energy Front-End\"), \".\"), mdx(\"p\", null, \"In a nutshell: A peripheral device broadcast advertisement packets on at least 1 of the 3 channels, with a repetition period called the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"advertisement interval\"), \".\"), mdx(\"p\", null, \"A scanning central device listens on these channels to detect advertisement packets.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Advertisement Interval & Scanning\")), mdx(\"p\", null, \"Page 2223 of the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=229737\"\n  }), \"Bluetooth Core Specification v4.0\"), \" explains advertisement intervals perfectly.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/bf10a105733707f60586c577ded59614/f247a/bluetooth_core_specs_page_2223.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"105.83333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAAChklEQVQ4y3WVC3OqMBCF+///m1qdqoAPEMQnVgUUBOvefFvT2itmZicb3Jzs2T2Jb1VVSV3Xcjqd5PPzU47Ho1qa5bLdp5IkW0l2OzkcDhqT5/ndzyU9HmS/P+i+siwV5+3r60tut5swCI6iyNhcgiAwYInZsNcD2HQ+n+V6vapd6qsMR4FMxmNZrze6HywFtONyuejG7XYrq9VKgWxGnP44KrOt68xk7LkSz+O/gDZDAAaDgQyHQ+n3++pj3W5XxiaTzWYjO0PfZp5nqR5oxxNgURSyXC7V1uu12mq1VqD5fK5gxJxPZ6WfGTAAa0O/ETA1Gbqup+Z5nsluqPNoNDIZTjRLu8Yc1xXf1JqGNAJyahzHJptYFouF+tAjxjbD+syPexsBy7LQZgBEt2ezmQLyO7SaQO23l03p9wfy8fGhtL+pjY3vqoxcxxXHcXQN9el0qj6HMgD+L8NS/KmvtUIqBNqZhthxk+bxpEO0BmXqt1wslbpd02X0SefRqtUrlqZZM2W0hf6gwdzpdIwGe2Z+l16vpz66bLfb+o251WqprBopU0NqRO2mhjrAzr1unjdSm0wmT1q93lk+y8ZcfoBoQBSFEvgT9em27wfqQx8xIzGMGjM3AhJIVz1zP8N5ItGiMBkkCghYEMxkZTKiSdCkjsx5fnp99b6FHRm/kvJyk6qqhScOBWDEFMWvT3Y8Ki9vCm+e7WRdX7SuiJzsLTCd5WBiWdNMGgLOEyCbAIvj31pBMdkmKg9i0/TvK/P9QNTNgJwIBU6lk+iQbxyCuKmZpfhY+0ZAahKGkdK0NSHjxwG4/dvAiLEP8BMgVLjH6JCuhmGoRpeZfd//kU2WZT/GPjDA+gd4FEGYpGVq8AAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Bluetooth Core Specs Page 2223\",\n    \"title\": \"Bluetooth Core Specs Page 2223\",\n    \"src\": \"/static/bf10a105733707f60586c577ded59614/7d769/bluetooth_core_specs_page_2223.png\",\n    \"srcSet\": [\"/static/bf10a105733707f60586c577ded59614/5243c/bluetooth_core_specs_page_2223.png 240w\", \"/static/bf10a105733707f60586c577ded59614/ab158/bluetooth_core_specs_page_2223.png 480w\", \"/static/bf10a105733707f60586c577ded59614/7d769/bluetooth_core_specs_page_2223.png 960w\", \"/static/bf10a105733707f60586c577ded59614/87339/bluetooth_core_specs_page_2223.png 1440w\", \"/static/bf10a105733707f60586c577ded59614/88b03/bluetooth_core_specs_page_2223.png 1920w\", \"/static/bf10a105733707f60586c577ded59614/f247a/bluetooth_core_specs_page_2223.png 2040w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"A scanning device listens on the advertisement channels for a duration called the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"scan window\"), \", which is repeated every \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"scan interval\"), \".\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Discovery latency\")), mdx(\"p\", null, \"We can use the three parameters: advertising interval, scan interval, and scan window to build a probabilistic model for discovery latency. Any such model will be practically flawed without considering the environment where devices will likely be used in.\"), mdx(\"p\", null, \"Shorter intervals and a higher scan window lead to faster discovery times while consuming more power.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Power consumption\")), mdx(\"p\", null, \"Ignore the general belief that advertisements are power-hungry. BLE advertisement is power efficient.\"), mdx(\"p\", null, \"Have a look at this \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developer.radiusnetworks.com/2015/12/09/battery-friendly-beacon-transmission.html\"\n  }), \"Android power consumption test\"), \".\"), mdx(\"p\", null, \"A study by beacon software company Aislelabs reported that peripherals such as proximity beacons usually function for 1\\u20132 years powered by a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"1,000mAh coin cell battery\"), \".\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"850px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/7347d0632c61c015509cfe839e3ae7b7/f20d0/BLE_Chipsets_Power.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"50.83333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACOUlEQVQozzWQWW/TUBCF/Sd55YV3HoCyPfM/kJB4AbUFpC6UVk3S0IS0KUqbQhY7sVNnc+rEsRMvsZOPsSvuaO7cc88ZzaK8O9nnye5HHn16z+OdDzzf2+bV9y88P9hhS/z10Ve2Dnez+Gx/mzc/vvFC8FuJKU61L8VT/uneZ5S9P8ccDYoUnCuORyV2bg8oTi/56VQ50HOcDM8pzqqciR/dnXHYzZG/r1AUPuX2O6fkJr+EvyRvX6Co/RbWcoSPh7Oyafeb8l4Qyj32Bti+RcCSSO70PZz3BbkZdmKbgWPireeZPhRG0U0dfWBgDHsM7odZ9NeBJERYjoU5NvETX9AK27O5E+yGnqAVju/QG/WymOqDdYhS0ksUugUKnQLlYZkzvUh7rdIRq81r5Dt5GmGDrti1U6Og5eX/GmmB+qLOqZqjMqpkem2jyciGynhqZRU9qdyTDkOplGJrZmFI934cEIvNFjOMvoEbuCRiaeyaXabeNOOjTYRy1ajStXXZSIAVWFx3bnA2jmxpjjrWuOneYCdTwS6mc0dNq2HOTdnygr7bp6bW0CV/Lnyap/weXXFulqhaVdqrNhejCzqbDrqMWHfrVIYVtEQTrNNY/qVslmkGzWzkVtik3C9z69WzlaR5iq7rtNotDENGC3xUTSVOYjabNZOJleFoFbERc5xZpp1JTM9i6ZHmT+0HLBKUKIwIw5AoiojjOHsnSZL5fy6JH3DKp3+r1epBE6+ZuhPaMuXQ1TBnDf4BoW7VAIbJJC0AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"./BLE_Chipsets_Power.png\",\n    \"title\": \"./BLE_Chipsets_Power.png\",\n    \"src\": \"/static/7347d0632c61c015509cfe839e3ae7b7/f20d0/BLE_Chipsets_Power.png\",\n    \"srcSet\": [\"/static/7347d0632c61c015509cfe839e3ae7b7/5243c/BLE_Chipsets_Power.png 240w\", \"/static/7347d0632c61c015509cfe839e3ae7b7/ab158/BLE_Chipsets_Power.png 480w\", \"/static/7347d0632c61c015509cfe839e3ae7b7/f20d0/BLE_Chipsets_Power.png 850w\"],\n    \"sizes\": \"(max-width: 850px) 100vw, 850px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"h3\", null, \"Pros\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Local & standalone: No LAN requirements.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Fast, reliable and power-efficient.\")), mdx(\"h3\", null, \"Cons\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Shorter distance: WiFi usually has 10x more range.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Unidirectional flow.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Scanning is expensive.\")));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"The inspiration for this project came from this tweet. A core tenet of the Apple camp is that their complete ecosystem makes every product…","timeToRead":9,"banner":{"childImageSharp":{"resize":{"src":"/static/f0099f12b2dbb465e1a8842b7fdddab3/73f08/inspiration_tweet.png"}}}}},"pageContext":{"slug":"/2020-11-10-rebuilding-apple-seamless-headphone-switch-feature-with-kotlin-multiplatform/","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["3090400250","3090400250","318001574"]}