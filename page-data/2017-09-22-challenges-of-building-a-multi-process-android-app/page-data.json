{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/2017-09-22-challenges-of-building-a-multi-process-android-app/","result":{"data":{"post":{"__typename":"MdxPost","slug":"/2017-09-22-challenges-of-building-a-multi-process-android-app/","title":"Challenges of building a multi-process Android App","date":"22.09.2017","tags":[{"name":"android","slug":"android"},{"name":"firebase","slug":"firebase"},{"name":"realm","slug":"realm"}],"description":null,"canonicalUrl":"https://elvischidera.com/2017-09-22-challenges-of-building-a-multi-process-android-app/","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Challenges of building a multi-process Android App\",\n  \"date\": \"2017-09-22T00:00:00.000Z\",\n  \"slug\": \"/2017-09-22-challenges-of-building-a-multi-process-android-app/\",\n  \"canonicalUrl\": \"https://elvischidera.com/2017-09-22-challenges-of-building-a-multi-process-android-app/\",\n  \"banner\": \"./assets/banner.png\",\n  \"tags\": [\"android\", \"firebase\", \"realm\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"While you might never have to build a multi-process app, it\\u2019s possible to have an Android app with components running in different processes. You get several benefits like more memory, performance improvement (depends on implementation) and more by going multi-process.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"510px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/fe3902f29f9c2e7e29f1f657c129ea9e/804c1/banner.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"67.91666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAADNklEQVQozw2SW0/bdgDF/Q32sE1TKbk7cez48redOBfHxHac4MQBx3bshFxgCwQlsDYLomSQFlhLEaq00rJu5VbCxjRpWl8qtW/r+hUmVVO/znLejnSk38PvQGQEhP1IPEIWJPnrhbqWy3csY8kwbF2vlOaL2WzDMqpGeaOz0rXM0Wqnki8YuWLTsMuzcxALOAKjDFH45XD/v0+frl5dnl9c/PPhw1+vX//9/v2jhw+PDg/fvnv378ePv4+vOnalY1o921m1LFstQelkJhFL1JXMsNs5GN47e/7s6vz0t/H1s6dPb25u+utrm9/1x+Px2enpwf5+t+oM2t/UdT3BxMWMAs0qxbyoZBhWjbL3De2PncHZvXU1kZRZlsMiMSYqp4UZLiElE3IqWZTlJMshIdznDYVgFMpnCzkxL9GMk4oPNfV8bfnPB5tWTp3j0xmKxsIEx3CZFK/JYkGcyaQSdIQMBVC/K+Ca8kBGydTU+UZW6czwj8qli3bzzcF9KSEIcZ5nYj5PAA1hUcDxsaQQjU7gAhdDA0jQBXumvZBtVh2jqpfMmiR+K6V/atX220sEyZE4TeEg4IVJBCNDWATBAU4mGFbk0yygA96g+7YHMuessla2VM0QM928vLtgPtneuNNum4USR3MIjKUiBE9QPGDxEEZGKJZkYoAJB1HXLTfkzFsrptGz9OX5oikJjiLt9pafP94/Gm5OhJcVxZblfDxOBFHUC/vcMBII4yhO4aR7ygs5Re1OzenXq92K3rX0qiLV+FQpLWrZ2aIoa3m1lstLIBryIbAH9k37AYLGWZbACNctDzQriOuO+bi/VstK3XLRltIyIFUSAD+CwqgAmGahQGFgMv3qi6nPP/sSnnJTGIYjEfdtH9RaaOxtbmz1VtcWWw8G/ZXGgq2Xf/xh7/u7d5u2M+p1D3Z2llpL9WrdsWuWUanZjqmXET/inqja2hpe/3q9uLg43BpOLrm7tzcYDCYPPT4+Ho1GP0/y4sVoe/vy4vLk5OTly9MnR0etRtM97fNMyJo6l+ZSKZrmSBLzB4kQwgE6RlBpNsZSIAaiMi+oSg6P0EE/4vMGcTgMgmgQRif1fxpKACLrISPVAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"banner\",\n    \"title\": \"banner\",\n    \"src\": \"/static/fe3902f29f9c2e7e29f1f657c129ea9e/804c1/banner.png\",\n    \"srcSet\": [\"/static/fe3902f29f9c2e7e29f1f657c129ea9e/5243c/banner.png 240w\", \"/static/fe3902f29f9c2e7e29f1f657c129ea9e/ab158/banner.png 480w\", \"/static/fe3902f29f9c2e7e29f1f657c129ea9e/804c1/banner.png 510w\"],\n    \"sizes\": \"(max-width: 510px) 100vw, 510px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"I won\\u2019t be talking about how \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://developer.android.com/guide/components/processes-and-threads.html#Processes\"\n  }), \"processes\"), \" work at the OS level here but rather the issues I faced building a multi-process app and how i solved them. You can read this \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://medium.com/@rotxed/going-multiprocess-on-android-52975ed8863c\"\n  }), \"article\"), \" to know more about multi-processes in Android.\"), mdx(\"h3\", null, \"1. SharedPreferences Support\"), mdx(\"p\", null, \"Unfortunately, \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://developer.android.com/reference/android/content/SharedPreferences.html\"\n  }), \"SharedPreference\"), \"s does not work (properly) on a multi-process app. Looking at the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://developer.android.com/reference/android/content/SharedPreferences.html\"\n  }), \"SharedPreferences\"), \" documentation, you will see the warning below:\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \" \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Note: currently this class does not support use across multiple processes. This will be added later.\"))), mdx(\"p\", null, \"Well, this is one case where later becomes never. The multi-process support that existed initially was deprecated by Google because it wasn\\u2019t very reliable. It\\u2019s been years already and there has been no update on this issue.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"600px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/986298558e84d8a951ec73053d2c86e6/2a8be/still_waiting_meme.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"73.75%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHXUEWgH//EABgQAAMBAQAAAAAAAAAAAAAAAAABEBES/9oACAEBAAEFAjI2dT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAbEAACAgMBAAAAAAAAAAAAAAABEQAQITFBUf/aAAgBAQABPyGBNOgBeuBMcr//2gAMAwEAAgADAAAAEBMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHhABAAEDBQEAAAAAAAAAAAAAAREAEEEhMVFhsfD/2gAIAQEAAT8QojIA5ZiyZCW9j7uli1m6rjg8t//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Patiently waiting for SharedPreferences multi-process support\",\n    \"title\": \"Patiently waiting for SharedPreferences multi-process support\",\n    \"src\": \"/static/986298558e84d8a951ec73053d2c86e6/2a8be/still_waiting_meme.jpg\",\n    \"srcSet\": [\"/static/986298558e84d8a951ec73053d2c86e6/46946/still_waiting_meme.jpg 240w\", \"/static/986298558e84d8a951ec73053d2c86e6/55489/still_waiting_meme.jpg 480w\", \"/static/986298558e84d8a951ec73053d2c86e6/2a8be/still_waiting_meme.jpg 600w\"],\n    \"sizes\": \"(max-width: 600px) 100vw, 600px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Luckily, I found a library called \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/grandcentrix/tray\"\n  }), \"Tray \"), \"that solves this problem perfectly. It is backed by a Content Provider and has methods very similar to that of SharedPreferences. This is a sample code using the library:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=Component.java\"\n  }), \"final AppPreferences appPreferences = new AppPreferences(getContext());\\n\\n// save a key value pair\\nappPreferences.put(\\\"key\\\", \\\"lorem ipsum\\\");\\n    \\n// read the value for your key. the second parameter is a fallback (optional otherwise throws)\\nfinal String value = appPreferences.getString(\\\"key\\\", \\\"default\\\");\\n\")), mdx(\"h3\", null, \"2. Firebase Support\"), mdx(\"p\", null, \"Another one :) was from the Firebase Library. You may have noticed that when working with the Firebase library, you don\\u2019t have to do any initialization in your custom Application class or in individual Activities. Well, they do the initialization of the Firebase library automatically for you using a dummy ContentProvider. From the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://firebase.googleblog.com/2016/12/how-does-firebase-initialize-on-android.html\"\n  }), \"Firebase blog\"), \":\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \" There is a little trick that the Firebase SDKs for Android use to install a hook early in the process of an application launch cycle. It introduces a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developer.android.com/reference/android/content/ContentProvider.html\"\n  }), \"ContentProvider\"), \" to implement both the timing and Context needed to initialize an SDK, but without requiring the app developer to write any code.\")), mdx(\"p\", null, \"Since Content Providers are only started on one (the main) process, you won\\u2019t be able to use any of the Firebase features on the other (non-main) processes. Any call to a Firebase method will result in an exception being thrown in that process. The fix for this is simple, first you remove the Firebase Initialization ContentProvider by adding the code below to your AndroidManifest.xml file inside the application tag.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-xml:title=AndroidManifest.xml\"\n  }), \"<provider\\n    android:name=\\\"com.google.firebase.provider.FirebaseInitProvider\\\"\\n    android:authorities=\\\"your.app.package.name.firebaseinitprovider\\\"\\n    android:enabled=\\\"true\\\"\\n    android:exported=\\\"false\\\"\\n    tools:node=\\\"remove\\\" />\\n\")), mdx(\"p\", null, \"Then you do the actual initialization in the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"onCreate\"), \" method of your custom Application class:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=Application.java\"\n  }), \"@Override\\npublic void onCreate() {\\n    super.onCreate();\\n    FirebaseApp.initializeApp(this, FirebaseOptions.fromResource(this));\\n}\\n\")), mdx(\"p\", null, \"This will ensure Firebase is initialized on all processes because unlike the ContentProvider methods that are only called on the main process, the onCreate of an Application will be called for each process (You will have multiple Application objects, and not one as you are inclined to believe).\"), mdx(\"h3\", null, \"3. Realm Database Support\"), mdx(\"p\", null, \"Realm Database does not officially support multi-process apps. While I was able to get the database to work across processes, A developer working for Realm advised me to wait for official support (\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://stackoverflow.com/questions/42733931/realm-multi-process-best-practice\"\n  }), \"Stackoverflow question\"), \"). Its been several months now and this haven\\u2019t been added yet and I don\\u2019t know if multi-process support will ever be added to Realm while I am alive (lol).\"), mdx(\"p\", null, \"I found a workaround which is to do all database operations on one (the main) process only. So other processes will get all their data through the main process. You can choose to broadcast database changes using a Broadcast Receiver or send data to components using Intents to the other process.\"), mdx(\"p\", null, \"Saving data is a bit tricky but works in a similar way. Since Android will run all component on the main process unless you specify a different one, I leveraged on this to save to the database. I created an IntentService subclass that has a sole purpose of saving to the database. I created a predefined set of intent actions that specify what data is being saved and the object to save is then passed as a parcelable intent extra. This might not be a neat solution but it works perfectly so far (On more than 3 thousand devices).\"), mdx(\"p\", null, \"Here is a link to the multi-process app on play store: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://play.google.com/store/apps/details?id=com.appcore.fxmusicplayer\"\n  }), \"https://play.google.com/store/apps/details?id=com.appcore.fxmusicplayer\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"While you might never have to build a multi-process app, it’s possible to have an Android app with components running in different processes…","timeToRead":3,"banner":{"childImageSharp":{"resize":{"src":"/static/fe3902f29f9c2e7e29f1f657c129ea9e/73f08/banner.png"}}}}},"pageContext":{"slug":"/2017-09-22-challenges-of-building-a-multi-process-android-app/","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["3090400250","3090400250","318001574"]}